
from alphamod import doAlpha
import random
from copy import copy
import hashlib


def testAlpha():
	
	random.seed(0)

	medialPointSoup = [[1.3935753748637394, -0.27533840163379275], [1.5289332552652444, -0.27885965029715398], [1.6346755432423854, -0.2806436966570674], [1.7593979186596327, -0.27761065060824958], [1.8651658042098906, -0.27655969812232217], [1.9606158384518306, -0.21867761140101893], [1.9847183425326689, -0.086233009030694918], [1.9402916170248856, 0.057447356528043614], [1.8481372638510409, 0.1243961683198008], [1.7360000971646701, 0.12893611914773115], [1.6008454354990531, 0.12799778594718114], [1.4759278279065211, 0.12204069125490966], [1.3758335776652242, 0.11923319527628266], [1.2457742731055237, 0.11566892233284358], [1.1155313454148787, 0.11221597531605151], [1.0152920935542458, 0.10964775136098984], [0.88551387578769236, 0.11094668923650036], [0.77967972895713211, 0.11003250837098301], [0.65493144225551581, 0.099880198977979867], [0.51926562355876305, 0.10305225214678342], [0.41924406674786169, 0.10037113208368151], [0.28906880479130337, 0.098048679365717789], [0.12906904205217001, 0.098324221415398705], [-0.01027441766970868, 0.074752535056653108], [-0.16447519594342019, 0.073576667461495021], [-0.32424675533297326, 0.082123527132189372], [-0.48401831472252621, 0.090670386802883571], [-0.63845344058711573, 0.088114091586746907], [-0.76315256789645103, 0.079655796233655415], [-0.92286753441537872, 0.070109620567042452], [-1.0825825009343064, 0.060563444900429586], [-1.2081326067493543, 0.068298109149258018], [-1.3329655736442891, 0.055327341458910606], [-1.4928584878589881, 0.061180202633660252], [-1.6527514020736871, 0.067033063808410176], [-1.8126443162883861, 0.072885924983159822], [-1.9446508549073804, 0.050288197140160751], [-2.0991742770649169, 0.036984537630623537], [-2.2590154529551678, 0.029857231686433283], [-2.4129861165990514, 0.034109040890471176], [-2.545703960462899, 0.040065384722962505], [-2.6578340641421527, -0.0036219779160480137], [-2.7587966046956804, -0.10505200105873347], [-2.8463751425388959, -0.20997575103636917], [-2.8585976829860233, -0.30224374487934302], [-2.7597245751477346, -0.34045448990954713], [-2.6259946982056439, -0.32711304672845176], [-2.4661267598460683, -0.32061364024330752], [-2.3062588214864936, -0.31411423375816344], [-2.184973662868003, -0.33695652985064062], [-2.0807492715474223, -0.30731740044476735], [-1.9207837137842048, -0.31063708860825273], [-1.7608181560209879, -0.31395677677173806], [-1.6222550532104798, -0.32954718003423183], [-1.4976353711685757, -0.3192254987383043], [-1.3378682870155298, -0.31059538742769033], [-1.1781012028624842, -0.3019652761170763], [-1.0183341187094386, -0.29333516480646227], [-0.90227374569468433, -0.31608997705426545], [-0.79274179815256107, -0.29434735293208353], [-0.63274235474486551, -0.29476938282158766], [-0.47274291133717006, -0.29519141271109173], [-0.33983086175151711, -0.30851538728662692], [-0.21526319720039652, -0.29837424775219196], [-0.09294087346774807, -0.26224397899016966], [0.067024755992605711, -0.26556021048885464], [0.22699038545295896, -0.26887644198753929], [0.36425673868852249, -0.29317896268238963], [0.52173111945500517, -0.29240260452303396], [0.62252303838266831, -0.29439328288487721], [0.74705460009496749, -0.28626056731785299], [0.8527713298304207, -0.29029566514017502], [0.97741858251634228, -0.28005980260436736], [1.113058999208784, -0.28335681405237678], [1.2133257580381009, -0.28038885935664021], [1.3433874873136535, -0.27687733628158212], [0.92594492671705664, 0.072228178071105265], [0.7661875234899217, 0.081035681356523392], [0.60643012026278686, 0.089843184641941631], [0.45492349080666383, 0.098195818759311881], [0.31470721232689558, 0.10521189257933722], [0.19465059987620123, 0.096958690455902538], [0.035071968623708129, 0.085354361626503186], [-0.11923950365165686, 0.082963215755310071], [-0.22981467264608904, 0.099801661993082019], [-0.35005755324713439, 0.083968287066957081], [-0.50903200285423589, 0.065881707176906945], [-0.64913929753483601, 0.049941650238938179], [-0.78001985772718863, 0.081149146914190701], [-0.91114703488558435, 0.11210712390673258], [-1.0504410169549243, 0.08778007007223626], [-1.1755273133111293, 0.084153081253985379], [-1.3301311534642737, 0.074561172239197393], [-1.4458799722729248, 0.090968144884405411], [-1.5769179403168645, 0.12231337597169395], [-1.725819435150977, 0.10158305304264004], [-1.8849321179938154, 0.084755867937746421], [-2.0303670682381658, 0.074868236867863924], [-2.1505639456969594, 0.074254692460435923], [-2.2507883857724691, 0.07708695089226314], [-2.3754348810275183, 0.073233469267452445], [-2.4067956476550312, -0.057793560449834414], [-2.4029873882771073, -0.18279957614712161], [-2.3645746222413231, -0.30150940895586598], [-2.2143000275311886, -0.32428748972491217], [-2.1033392108671114, -0.33392509671881643], [-1.9783205277207969, -0.33000465039525861], [-1.8586194880334679, -0.32138207029530336], [-1.7336316612201121, -0.31763438454614223], [-1.6034681868099885, -0.32104267208447967], [-1.4785547062067286, -0.31510292387455741], [-1.3535996161142332, -0.31339688217425354], [-1.2234717720809369, -0.31678948566000892], [-1.0935481639149085, -0.3134634132916802], [-0.99824013453536664, -0.31580836092104614], [-0.87351847294947349, -0.3119992416981946], [-0.74861420583273341, -0.30810099773072058], [-0.61857351071731648, -0.30924074581310435], [-0.498406728699052, -0.3006428802471709], [-0.33862840186329612, -0.29222348160080774], [-0.17885007502754025, -0.28380408295444459], [-0.053972972926452402, -0.27722377807071391], [0.095941415390628573, -0.29996024475015715], [0.19585257330021005, -0.26964717838485586], [0.35570574860607773, -0.27650008613496646], [0.51555892391194547, -0.28335299388507695], [0.65143467839553681, -0.28836884138001539], [0.7570215814843918, -0.29788359067504783], [0.88085648734928113, -0.26461703298075268], [1.0408273836200932, -0.26156541925796795], [1.2007982798909052, -0.25851380553518322], [1.344162055286872, -0.2680352844044237], [1.471547992807654, -0.28163093982970466], [1.5957689484881055, -0.25197359016166104], [1.7553440178102104, -0.26362679791083077], [1.9149190871323163, -0.2752800056600006], [2.0719685036898148, -0.28283418808019001], [2.1665069100392991, -0.23757866471349282], [2.2794071297408007, -0.16420447724005222], [2.4074690908362206, -0.11965228833459729], [2.5265665398119928, -0.081164323209314326], [2.5949670391330635, -0.032760900696210515], [2.5303907375538537, 0.097712981463588311], [2.4453656769355843, 0.10287703252550484], [2.3217430790572195, 0.047504220141101006], [2.192617941391926, 0.052595766379089803], [2.0330456188975274, 0.06428652742119989], [1.8762730227670397, 0.075772171865443272], [1.7451587199974887, 0.10697424566278169], [1.6006428326337647, 0.087912841669557429], [1.4406719443012943, 0.084860811833482597], [1.2807010559688239, 0.081808781997407432], [1.1384556985458312, 0.094222796979245405], [1.0026527370258635, 0.094611278344889416]]
	nomPoints = [[1.39358, -0.27533999999999997], [1.4715499999999999, -0.28162999999999999], [1.5289299999999999, -0.27885900000000002], [1.6346700000000001, -0.280644], [1.7594000000000001, -0.277611], [1.8651599999999999, -0.27655999999999997], [1.91492, -0.275281], [2.0719699999999999, -0.28283399999999997], [2.1665100000000002, -0.23757600000000001], [2.2794099999999999, -0.16420399999999999], [2.40747, -0.119653], [2.52657, -0.081164200000000006], [2.59497, -0.032760699999999997], [2.5303900000000001, 0.097712900000000005], [2.44536, 0.102878], [2.1926199999999998, 0.052595200000000002], [2.0330499999999998, 0.0642842], [1.8481399999999999, 0.12439500000000001], [1.736, 0.12893399999999999], [1.60084, 0.127999], [1.47593, 0.12204], [1.3758300000000001, 0.11923300000000001], [1.24577, 0.11566899999999999], [1.1155299999999999, 0.112215], [1.01529, 0.109648], [0.88551400000000002, 0.110948], [0.77968000000000004, 0.110032], [0.65493100000000004, 0.099879200000000001], [0.51926600000000001, 0.103051], [0.41924499999999998, 0.100371], [0.31470599999999999, 0.105212], [0.19464999999999999, 0.096958199999999994], [0.12906799999999999, 0.098325999999999997], [0.035071600000000001, 0.085355200000000006], [-0.119239, 0.082962599999999997], [-0.22981499999999999, 0.099801600000000004], [-0.35005799999999998, 0.083967399999999998], [-0.484018, 0.090670799999999996], [-0.63845600000000002, 0.088113999999999998], [-0.76315200000000005, 0.079656599999999994], [-0.78002000000000005, 0.081149799999999994], [-0.91114899999999999, 0.112109], [-1.05044, 0.087778999999999996], [-1.17553, 0.084152099999999994], [-1.33013, 0.0745619], [-1.4458800000000001, 0.090968199999999999], [-1.5769200000000001, 0.12231400000000001], [-1.7258199999999999, 0.10158200000000001], [-1.88493, 0.084754999999999997], [-2.03037, 0.074868799999999999], [-2.15056, 0.074253700000000006], [-2.2507899999999998, 0.077086699999999994], [-2.3754400000000002, 0.073233699999999999], [-2.5457000000000001, 0.040064000000000002], [-2.6578400000000002, -0.0036222300000000002], [-2.7587999999999999, -0.10505299999999999], [-2.8463699999999998, -0.209978], [-2.8586, -0.30224499999999999], [-2.7597200000000002, -0.34045500000000001], [-2.6259999999999999, -0.32711299999999999], [-2.4661200000000001, -0.32061400000000001], [-2.30626, -0.31411499999999998], [-2.1849699999999999, -0.33695700000000001], [-2.1033400000000002, -0.33392500000000003], [-1.9783200000000001, -0.33000600000000002], [-1.8586199999999999, -0.321378], [-1.73363, -0.317635], [-1.62225, -0.32954800000000001], [-1.4976400000000001, -0.31922600000000001], [-1.3535999999999999, -0.31339600000000001], [-1.2234700000000001, -0.31679000000000002], [-1.09355, -0.31346499999999999], [-0.99824000000000002, -0.31580799999999998], [-0.90227400000000002, -0.31608999999999998], [-0.87351999999999996, -0.31200099999999997], [-0.74861500000000003, -0.30809799999999998], [-0.61857200000000001, -0.30924000000000001], [-0.49840699999999999, -0.30064299999999999], [-0.33983099999999999, -0.30851499999999998], [-0.21526300000000001, -0.29837399999999997], [-0.053972199999999998, -0.277223], [0.095940899999999996, -0.29996099999999998], [0.364257, -0.29317900000000002], [0.52173099999999994, -0.29240100000000002], [0.62252300000000005, -0.29439300000000002], [0.75702199999999997, -0.29788399999999998], [0.85277400000000003, -0.290294], [0.97741900000000004, -0.280059], [1.1130599999999999, -0.28335900000000003], [1.21333, -0.280389], [1.3433900000000001, -0.27688000000000001], [1.39358, -0.27533999999999997]]


	#vert_md5_nom = 309190435843255422902767581684566207722
	vert_md5_nom = 155861658077480672408011483909217870768
	
	" alpha shape circle radius "
	radius = 0.2

	numPoints = len(medialPointSoup)

	isDone = False
	
	while not isDone:

		perturbPoints = []
		
		for p in medialPointSoup:
			p2 = copy(p)
			" add a little bit of noise to avoid degenerate conditions in CGAL "
			p2[0] += random.gauss(0.0,0.000001)
			p2[1] += random.gauss(0.0,0.000001)

			perturbPoints.append(p2)


		
		try:			

			vertices = doAlpha(radius,perturbPoints)
			numVert = len(vertices)
			
			if numVert <= 2:
				print "Failed, hull had only", numVert, "vertices"
				raise
			
			isDone = True
		except:
			print "hull has holes!  retrying..."
			#print sArr	

	m = hashlib.md5()
	m.update(repr(vertices))
	vert_md5 = int(m.digest().encode('hex'),16)	
	
	if vert_md5 == vert_md5_nom:
		print "alpha PASS"
	else:
		print "alpha FAIL"

	#for k in range(len(vertices)):
	#	print nomPoints[k], vertices[k]

	#print "vert_md5_nom = " + repr(vert_md5)

	#print nomPoints[-1]
	#print numPoints, len(nomPoints), len(vertices)

while True:
	testAlpha()
