Jacob Everist
September 6, 2013

Questions:

MOVE ESTIMATION


MAP INTEGRATION


ADD NEW POSES, CREATE NEW PATHS
- Which path or set of paths does this pose currently overlap?
	getOrderedOverlappingPaths()
	- of all splices in local neighborhood, find the best fit based on highest contiguity with initial estimated pose
	- in order of best fits, pick the first that overlaps all constituent paths, that is, does not have paths in the splice beyond the range of the pose sensor data
	- for the constituent path IDs of the chosen splice, order them according to sequence they are overlapped by the pose curve
	- return the ordered list of path IDs that this pose curve overlaps

- Does this pose fit on the path splice or does it depart internally?
	getDeparturePoint() of orderedPathIDs
	- get departure state of the front pathID and back pathID with pose curve
	- if the pose curve does not depart internally, add this node to the leaf path(s)

- If it internally departs, given the departure state of the splice, are the pose departure parameters sufficient for a new branch?
	- is the proposed new branch sufficiently unique
		- is the distance from the parent's branch point sufficiently far?  (0.8)
		- is a path sibling's sufficiently close (0.5) branch point not angled in the same direction (PI/6 tolerance)?
		- is the pose curve featured?
		- if all true, then this new branch is sufficiently unique

- If the new branch is sufficiently unique, then create the new branch with the current pose
- Regenerate the paths with the new node data

TRY TO MERGE PATHS TOGETHER

- select parent and child path pairs
- select sibling path pairs

- if sibling pairs,
	- create a stitched path of parent with section between two child junction points excised and the relative orientations of the junction points are aligned
	- select common point between parent path and stitched parent path
	- perform ICP fit between stitched parent and original parent
	- return the resulting pose offsets for both sibling paths and their relative junction angle
	- if the angle of both offsets is < 0.5 and the junction angle difference is < PI/4, than we queue the sibilngs to be merged
	

- if parent-child pairs,
	- create a set of splices for the parent path and the child path	
		- if grandparent exists,
			- generate gparent/parent splices and gparent/parent/child splices
		- else
			- generate parent splices and parent/child splices
	- select common point between parent splice and child splice
	- perform ICP fit between parent splice and child splice pathOverlapICP()
	- return the resulting offset between the two
	- if the resulting offset angle < 0.5 radians
		- compute the departure state of the two paths given their relative offset getPathDeparture()
		- if one path does not internally depart from the other
			- and if the two paths with their relative offset partially overlap getPathOverlapConditionn()
				- then we queue the child and parent paths for merging

- merge sibling pairs

- merge parent-child pairs
	- select child nodes
	- move them by earlier ICP-fitted offset
	- find the most consistent fit in all set of splices in the node's new neighborhood consistentFit()


	- change their classification to parent path



Where to fit the path?
Does the pose fit on this path?
Does the pose cause a branch onto new path?


Fitting a pose to a path.


